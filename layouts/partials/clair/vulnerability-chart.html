{{ $id := delimit (shuffle (seq 1 9)) "" }}

<style>
    .vulnerability-chart {
        display: inline-block;
        position: relative;
        width: 300px;
    }
</style>

<div class="w-50 mx-auto">
    <canvas id="{{ $id }}"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

{{ $vulnerabilitiesScratch := newScratch }}

{{/* Init labels */}}
{{ $vulnerabilityLabels := (slice "Critical" "High" "Medium" "Low" "Informational" "Undefined")}}
{{ range $vulnerabilityLabels }}
{{ $vulnerabilitiesScratch.Set . 0 }}
{{ end }}

{{ $values := slice }}

{{ range $vuln := . }}
{{ $vulnerabilitiesScratch.Set (title (lower $vuln.severity)) (add 1 ($vulnerabilitiesScratch.Get
(title (lower $vuln.severity)) | default 0)) }}
{{ end }}

{{ range $severity, $count := $vulnerabilitiesScratch.Values }}
{{ $values = $values | append (slice $count) }}
{{ end }}

<script>
    function renderChart(id, values) {
        const labels = [
            "Critical",
            "High",
            "Medium",
            "Low",
            "Informational",
            "Unknown",
        ];
        const data = {
            labels: labels,
            datasets: [{
                label: 'Vulnerability report',
                backgroundColor: [
                    '#ff7169',
                    '#ffa178',
                    '#ffca93',
                    '#ffe3af',
                    '#cee8f0',
                    '#ddd'
                ],
                data: values,
            }]
        };

        const config = {
            type: 'doughnut',
            data: data,
            options: {
            }
        };

        const myChart = new Chart(
            document.getElementById(id),
            config
        );
    }
    renderChart("{{ $id }}", {{ $values }});
</script>